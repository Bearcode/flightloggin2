{% extends "base.html" %}
{% block events-sel %}nav_selected{% endblock%}

{% block javascript %}
    <script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/popup.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/event_popup.js"></script>
	<script type="text/javascript">
	    $(document).ready(function() {
	        $("input[id$=date]").datepicker({
			        dateFormat: "yy-mm-dd",
			        yearRange: "-80:+1", 
			        showOn: "button", 
			        buttonImage: "{{ MEDIA_URL }}/images/calendar.gif", 
			        buttonImageOnly: true ,
			        changeYear: true
	        }).addClass("embed");
	        
	        
	        $("a.nonflight_click").click(function() {
	        
	            prepare_edit_event(true);
	            fill_in_event(this.id);
	            fire_popup();
	    
	        });
	        
	        $("#new_event").click(function() {
	        
	            prepare_new_event(true);
	            
	            fire_popup();
	    
	        });
	        
	    });
    
	</script>
	<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/css/records.css">
	<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/css/popup.css">
{% endblock %}

{% block title %}Events{% endblock %}

{% block canvas %}

{% if not shared %}
    <input type="button" id="new_event" value="New Event">
{% endif %}

    <table class="nonflight_table">
       <tr>
           <td>Date</td><td>Type</td><td>Remarks</td>
       </tr>
    {% for nf in nonflights %}
       <tr id="row_{{nf.id}}">
           <td class="date" title="Date (click to edit)">
                <span class="unformatted_date">{{nf.date}}</span>
                <a class="nonflight_click" id="n{{nf.id}}" href="">{{ nf.date|date:date_format }}</a>
           </td>
           <td class="non_flying">{{ nf.get_non_flying_display }}</td>
           <td class="remarks">{{ nf.remarks }}</td>
       </tr>
    {% empty %}
    
       <tr><td colspan="3">Nothing to show here</td></tr>
       
    {% endfor %}    
    </table>

<div id="popup" title="New Event">
	<table id="dragbar">
		<tr>
			<td><span id="titlebar">New Event</span></td>
			<td><span id="close_x" title="Close this popup">[X]</span></td>
		</tr>
	</table>
	
	<form id="new_plane_form" action="{% url events user.username %}" method="post">
		<table>
			<tbody>
				<tr>
					<td>		
					    <input type="hidden" name="user" id="id_user" value="{{ user.id }}" />
						<input type="hidden" name="id" id="id_id" value="" />
					</td>
				</tr>
				<tr>
					<td>{{ form.date.label_tag }}</td>
					<td>{{ form.date }}<br><span class="help_text">{{form.date.help_text}}</span></td>
				</tr>
				<tr>
					<td>Event</td>
					<td>{{ form.non_flying }}<br><span class="help_text">{{form.non_flying.help_text}}</span></td>
				</tr>
			
				<tr>
					<td>{{ form.remarks.label_tag }}</td>
					<td>{{ form.remarks }}<br><span class="help_text">{{form.remarks.help_text}}</span></td>
				</tr>
			</tbody>
		</table>
		
    	<div id="new_buttons">
			<input type="submit" name="submit" value="Create New Event" />
		</div>

		<div id="edit_buttons">
			<input type="submit" name="submit" value="Submit Changes" />
			<input type="submit" name="submit" value="Delete Event" />
		</div>

	</form>
</div>


{% endblock %}
