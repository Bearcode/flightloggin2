{% extends "base.html" %}
{% block logbook-sel %}nav_selected{% endblock%}

{% block description %}{{ request.display_user.username }}'s flights{% endblock%}

{% block javascript %}
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/popup.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/flight_popup.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/logbook.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/sprintf.js"></script>

<script type="text/javascript">
    $(document).ready(function() {
        page_totals({{agg_columns|safe}})  // pass in the names of each column that needs a page total
    });
    
    date_button = "{{MEDIA_URL}}/images/calendar.gif"
    auto_button = {{ auto_button.as_jslist|safe|default:"[]" }}
</script>

<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/logbook.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/custom_view.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/route.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/popup.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/flight_popup.css">
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/jquery/css/black-tie/jquery-ui-1.7.1.custom.css">
<link rel="alternate" title="{{ request.display_user.username }}'s flights feed" href="/feeds/flights/{{request.display_user.username}}" type="application/rss+xml">

{% endblock %}

{% block title %}Flights{% endblock %}

{% block canvas %}
    
    {% if not request.shared %}
	<input id="new_flight_button" type="button" value="New Flight" />
	{% endif %}
	
	{% include "pagination_table.html" %}
		
	<table id="logbook_table" summary="logbook table">
		<thead>
			<tr class='header'>
                    {{ header_row|safe }}
			</tr>
		</thead>
		
		<tfoot>
			<tr>
				<td colspan="{{ prefix_len }}" id="page_total_title">
				Page Totals:
				</td>
    
                   {% for column in agg_columns %}
                       <td id="{{ column }}_pt" class="{{column}} pt"></td>
                   {% endfor %}

				<td colspan="6">
				</td>
			</tr>
			<tr>

				<td colspan="{{ prefix_len }}" id="overall_total_title">
				{{total_sign}} Totals:
				</td>

                    {% for column in overall_totals %}
                        <td>{{column}}</td>
                    {% endfor %}
                    
				<td colspan="6">
				    {% if flights and not request.shared %}
					<a href="{% url mass-edit request.display_user.username page_of_flights.number %}">Mass Edit</a>
					{% endif %}
				</td>
			</tr>
		</tfoot>
		
		<tbody>

		{% for row in logbook %}
		<tr>
            {% for item in row %}    
                <td title="{{item.title}}" class="{{item.system}}_col">{{item.disp}}</td>    {# all other columns #}
            {% endfor %}
		</tr>
		
		{% empty %}
	
		<tr>
			<td colspan="50" class="empty_logbook">No flights to display</td>
		</tr>
			
		{% endfor %}
		
		{# header row at the bottom #}
		<tr class='header'>
		    {{ header_row|safe }}
		</tr>
		
		</tbody>
	</table>
	
	{% for row in logbook %}
        <div class="small_popup" id="s{{row.pk}}">
        
            <a href="" class="edit_popup_link" id="f{{row.pk}}" id="f{{row.pk}}">
                Edit this flight
            </a>
            <br>
            <a target="_blank" href="{% url s-route-kml row.flight.pk %}">
                View this route in Google Earth
            </a>
            <br>
            <a target="_blank" href="{% url s-route-maps row.flight.pk %}">
                View this route in Google Maps
            </a>

            <br>
            {% url profile-route row.route.simple_rendered as pr %}
            <a href="{{pr}}">
                More info about this route 
            </a>
            <br>
            {% url profile-tailnumber row.flight.plane.tailnumber|upper|urlencode as pt%}
            <a href="{{pt}}">
                More info about this tailnumber
            </a>      
            
        </div>
	{% endfor %}
	
	{% include "pagination_table.html" %}
	<hr>
	{% include "filter_table.html" %}
	
	</form>
{% include "new_flight.html" %}
{{ff.errors}}
{% endblock %}

