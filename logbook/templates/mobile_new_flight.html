<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>New Flight</title>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="{% static 'js/jquery.jclock.js' %}"></script>
    </head>
    <body>
        <div id="clock"></div>
        <button id="takeoff_button">Takeoff</button>
        <form method="post">
            <input type="text" id="total" placeholder="Total"><input type="button" value=""><br>
            <input type="text" placeholder="PIC"><br>
            <input type="text" placeholder="SIC"><br>
            <input type="text" placeholder="Day Landings" id="day_landings"><br>
            <input type="button" id="landing_button" value="Land">
        </form>

        <a href="/logbook">Back to logbook</a>
        
        <script>

        function get_current_time() {
            // return the current state of the UTC clock, parsed to integers.
            var t = $("#clock").text().split(':');
            return [parseInt(t[0]), parseInt(t[1]), parseInt(t[2])]
        }

        function get_nearest_airports() {
            navigator.geolocation.getCurrentPosition(
                function(loc) {
                    $.ajax({
                        url: '/nearby_airports.json',
                        data: {'lng': loc.coords.longitude, 'lat': loc.coords.latitude},
                        success: function(res) {
                            console.log(res);
                        }
                    });
                },
                function(){
                    console.log("no loc");
                }
            );
        }

        function get_difference(t1, t2) {
            // get the difference between two clock times.
            // t1 = ["05", "23", "13"] t2 = ["06", "50", "02"]
            if(t1[0] > t2[0]) {
                // clock has spanned 00:00, calculate differently
                var h0 = 23 - t1[0];
                var m0 = 59 - t1[1];
                var s0 = 60 - t1[2];
                var h = t2[0] + h0;
                var m = t2[1] + m0;
                var s = t2[2] + s0;

                if(s >= 60) {
                    s = s - 60;
                    m += 1
                }

                if(m >= 60) {
                    m = m - 60;
                    h += 1;
                }
            } else {
                var h = t2[0] - t1[0];
                var m = t2[1] - t1[1];
                var s = t2[2] - t1[2];
            }
            return [h, m, s];
        }

        $("#takeoff_button").click(function() {
            var start_time = get_current_time();
            $("#total").val("0.0");
            setInterval(function() {
                var current_time = get_current_time();
                var elapsed = get_difference(start_time, current_time);
                console.log(elapsed);
            }, 60000);
        });
        $("#clock").jclock({utc: true, fontSize: "36px"});
        $('#landing_button').click(function() {
            var old = $('#day_landings').val();
            if(old == '') {
                old = 0
            }
            var n = parseInt(old) + 1;
            $('#day_landings').val(n);
            console.log('sdad', old, n);
        });
        </script>
    </body>
</html>