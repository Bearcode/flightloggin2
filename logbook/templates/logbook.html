{% extends "base.html" %}
{% load logbook_tags %}
{% load cache %}

{% block description %}{{ request.display_user.username }}'s flights{% endblock%}

{% block javascript %}
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/popup.js?"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/flight_popup.js?"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/logbook.js?"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}/javascripts/sprintf.js"></script>

<script type="text/javascript">
    NAVBAR_HIGHLIGHT = "logbook-sel";
    $(document).ready(function() {
        page_totals({{cols.agg_list|safe}})  // pass in the names of each column that needs a page total
    });
    
    date_button = "{{MEDIA_URL}}/images/calendar.gif"
    auto_button = {{ auto_button.as_jslist|safe|default:"[]" }}
</script>

<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/logbook.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/custom_view.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/route.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/popup.css">
<link rel="stylesheet" type="text/css" href="{{ CSS_URL }}/flight_popup.css">
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/jquery/css/black-tie/jquery-ui-1.7.1.custom.css">
<link rel="alternate" title="{{ request.display_user.username }}'s flights feed" href="/feeds/flights/{{request.display_user.username}}" type="application/rss+xml">

{% endblock %}

{% block title %}Flights{% endblock %}

{% block canvas %}
    
    {% if not request.shared %}
	<input id="new_flight_button" type="button" value="New Flight" />
	{% endif %}
	
	{% include "pagination_table.html" %}
		
	<table id="logbook_table" summary="logbook table">
		<thead>
			<tr class="header">
                    {{ cols.header_row|safe }}
			</tr>
		</thead>
		{% if get %}
		    {% include "logbook_totals_part.html" %}
		{% else %}
		
		    {% cache 10800 logbook_totals request.display_user %}
                {% include "logbook_totals_part.html" %}
		    {% endcache %}
		    
		{% endif %}
		<tbody>
		{% if get %}
		
		    {% include "logbook_cells_part.html" %}
		    
		{% else %}
		
            {% cache 10800 logbook page request.display_user %}
		        {% include "logbook_cells_part.html" %}
		    {% endcache %}
		    
		{% endif %}
		
		{# header row at the bottom #}
		<tr class='header'>
		    {{ cols.header_row|safe }}
		</tr>
		
		</tbody>
	</table>
	{% if page_of_flights.object_list and not request.shared %}
		<a href="{% url mass-edit request.display_user.username page_of_flights.number %}">Mass Edit this page</a>
	{% endif %}
	
	{% for row in page_of_flights.object_list %}
        <div class="small_popup" id="s{{row.pk}}">
        
            <a href="" class="edit_popup_link" id="x{{row.pk}}">
                Edit this flight
            </a>
            <br>
            <a target="_blank" href="{% url single_route-kml row.pk "f" as kml %}{{ kml }}">
                View this route in Google Earth
            </a>
            <br>
            <a target="_blank" href="http://maps.google.com/?q=http://flightlogg.in{{ kml }}">
                View this route in Google Maps
            </a>

            <br>
            {% url profile-route row.route.simple_rendered as pr %}
            <a href="{{pr}}">
                More info about this route 
            </a>
            <br>
            {% url profile-tailnumber row.plane.tailnumber|upper as pt%}
            <a href="{{pt}}">
                More info about this tailnumber
            </a>      
            
        </div>
	{% endfor %}
	
	{% include "pagination_table.html" %}
	<hr>
	{% include "filter_table.html" %}
	
	</form>
{% include "new_flight.html" %}
{{ff.errors}}
{% endblock %}

